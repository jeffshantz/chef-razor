# dhcp.conf - DHCP server configuration
# 
# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.

# Disable DNS services
port=0

# Uncomment to enable debug logging for DHCP
#log-dhcp

# Disable multicast
#dhcp-option=vendor:PXEClient,6,2b

# Disable re-use of the DHCP servername and filename fields as extra option
# space.  If it can, dnsmasq moves the boot server and filename information
# (from dhcp-boot) out of their dedicated fields into DHCP options. This
# makes extra space available in the DHCP packet for options but can, rarely,
# confuse old or broken clients. This flag forces "simple and safe" behaviour
# to avoid problems in such a case.
dhcp-no-override

# Uncomment to ignore requests from unknown MAC addresses.  Razor should handle
# this, so it should not be necessary to enable this.
#dhcp-ignore=tag:!known

# If the client is already running iPXE (or has already loaded undionly), 
# serve uip bootstrap.ipxe
dhcp-match=IPXEBOOT,175
dhcp-boot=net:IPXEBOOT,bootstrap.ipxe

# Otherwise, serve up undionly.kpxe, and then bootstrap.ipxe
dhcp-boot=undionly.kpxe

# Provide DHCP and boot parameters to the following hosts

<% node[:razor][:dhcp].each do |range| -%>
dhcp-range=<%= range[:start_ip] %>,<%= range[:end_ip] %>,<%= range[:netmask] %>,<%= range[:lease] %>
<% end -%>

# Provide only boot parameters to the following hosts (i.e. serve as a proxy
# DHCP server).  The IP listed below is not important since we're not handing 
# out IP addresses to hosts on these subnets -- any IP address in each subnet
# will do. 

<% node[:razor][:proxydhcp].each do |range| -%>
dhcp-range=<%= range[:network] %>,proxy,<%= range[:netmask] %>
<% end -%>

# TFTP setup
enable-tftp
tftp-root=/var/lib/tftpboot
