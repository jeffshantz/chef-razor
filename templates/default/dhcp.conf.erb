# dhcp.conf - DHCP server configuration
# 
# Generated by Chef for <%= node['fqdn'] %>
# Local modifications will be overwritten.

# Disable DNS services
port=0

# Uncomment to enable debug logging for DHCP
#log-dhcp

# Disable multicast
#dhcp-option=vendor:PXEClient,6,2b

# TFTP setup
enable-tftp
tftp-root=/var/lib/tftpboot

# Disable re-use of the DHCP servername and filename fields as extra option
# space.  If it can, dnsmasq moves the boot server and filename information
# (from dhcp-boot) out of their dedicated fields into DHCP options. This
# makes extra space available in the DHCP packet for options but can, rarely,
# confuse old or broken clients. This flag forces "simple and safe" behaviour
# to avoid problems in such a case.
dhcp-no-override

<% if node[:razor][:ignore_unknown_macs] -%>
# Ignore requests from unknown MAC addresses.  Razor handles this, so it should
# not really be necessary, but it avoids having an unknown node boot into the
# Razor microkernel.
dhcp-ignore=tag:!known
<% end -%>

# If the client is already running iPXE (or has already loaded undionly),
# serve up bootstrap.ipxe
dhcp-match=set:ipxe,175 # iPXE sends a 175 option.

# If the client is not already running iPXE, then serve up undionly first
pxe-service=tag:!ipxe,X86PC, "Booting iPXE", undionly

# Served if the client is running iPXE
dhcp-boot=<%= node[:razor][:bootstrap_ipxe_url] %>

# Provide DHCP and boot parameters to the following hosts

<% node[:razor][:dhcp].each do |range| -%>
dhcp-range=<%= range[:start_ip] %>,<%= range[:end_ip] %>,<%= range[:netmask] %>,<%= range[:lease] %>
<% end -%>

# Provide only boot parameters to the following hosts (i.e. serve as a proxy
# DHCP server).  The IP listed below is not important since we're not handing 
# out IP addresses to hosts on these subnets -- any IP address in each subnet
# will do. 

<% node[:razor][:proxydhcp].each do |range| -%>
dhcp-range=<%= range[:network] %>,proxy,<%= range[:netmask] %>
<% end -%>
